// Generated by CoffeeScript 1.9.3
(function() {
  var app,
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  app = angular.module("app");

  app.controller("userCtrl", function($scope, $rootScope, $http, $location) {
    $http.get('/backend/api/user/info/').success(function(response) {
      $scope.username = response.data.user_name;
    });

    $scope.logout = function() {
      $http.post('/logout/', $scope.modifyData).success(function(response) {
        return window.location.href = '/login/';
      });
    };

    $scope.modify_password = function(modifyData) {
      if (modifyData.new_password != modifyData.confirm_password) {
        return alert("The two new passwords are different");
      };
      return $http.post('/modify/password/', $scope.modifyData).success(function(response) {
        if (response.code == 1) {
          $http.post('/logout/', $scope.modifyData).success(function(response) {
            return window.location.href = '/login/';
          });
        } else {
          return alert(response.message);
        };
      });
    };
  });

  app.controller("userListCtrl", function($scope, $rootScope, $http, $location) {
    $scope.list = [];
    $scope.total_aggregate = [];
    $scope.pager = {
      total: 0,
      size: 20,
      index: 1
    };

    $scope.search = function() {
      $rootScope.loadding = true;
      var data = angular.extend($scope.pager, $scope.query);
      $http.get('/backend/api/user/list/', {params: data}).success(function(response) {
        $scope.list = response.data;
        $scope.pager.total = response.total;
        return $rootScope.loadding = false;
      });
    };

    $scope.search();
    $scope.change_page = function() {
      return $scope.search();
    };
    $scope.delete = function(region_id) {
      if (confirm("Confirm delete?")) {
        data = {region_id: region_id};
        $http.post('/micou/region/j/delete/', data).success(function(response) {
          $rootScope.loadding = true;
          $scope.search();
        });
      }
    };

    $scope.create = function(formData) {
      $rootScope.loadding = true;
      console.log(formData);
      var data = formData;
      $http.post('/backend/api/user/create/', data).success(function(response) {
        $rootScope.loadding = false;
        return $location.path("/user/list/");
      });
    };

  });

  app.controller("productTypeCtrl", function($scope, $rootScope, $http, $location) {
    $scope.list = [];
    $scope.total_aggregate = [];
    $scope.pager = {
      total: 0,
      size: 20,
      index: 1
    };
    $scope.type_status = [{"label": "正常", "value": 1}, {"label": "下架", "value": 0}];

    $scope.search = function() {
      $rootScope.loadding = true;
      var data = angular.extend($scope.pager, $scope.query);
      $http.get('/backend/api/product/type/list', {params: data}).success(function(response) {
        $scope.list = response.data;
        $scope.pager.total = response.total;
        return $rootScope.loadding = false;
      });
    };

    $scope.search();
    $scope.change_page = function() {
      return $scope.search();
    };
    $scope.delete = function(region_id) {
      if (confirm("Confirm delete?")) {
        data = {region_id: region_id};
        $http.post('/backend/api/product/delete/', data).success(function(response) {
          $rootScope.loadding = true;
          $scope.search();
        });
      }
    };

    $scope.save = function(formData) {
      $rootScope.loadding = true;
      var data = formData;
      $http.post('/backend/api/product/type/' + data["method"], data).success(function(response) {
        $rootScope.loadding = false;
        $scope.search();
      });
    };

    $scope.create = function() {
      $scope.formData = {status: 1, method: "create"};
    };

    $scope.update = function(type_id) {
      var data = {type_id: type_id};
      $http.get('/backend/api/product/type/info', {params: data}).success(function(response) {
        $scope.formData = response.data;
        $scope.formData["method"] = "update";
      });
    };

    $scope.delete = function(type_id) {
      var data = {type_id: type_id};
      $http.post('/backend/api/product/type/delete', data).success(function(response) {
        $scope.search();
      });
    };

    $scope.uploadFile = function(file_type) {
      $rootScope.loadding = true;
      var file = document.getElementById("imageUpload").files[0];
      return $http({
        url: '/backend/api/upload/file/?file_type=' + file_type,
        method: 'POST',
        data: file
      }).success(function(data, status, headers, config) {
        $rootScope.loadding = false;
        $scope.formData[file_type] = data.data;
        return console.log(data);
      });
    };
  });

  app.controller("productListCtrl", function($scope, $rootScope, $http, $location) {
    $scope.list = [];
    $scope.total_aggregate = [];
    $scope.pager = {
      total: 0,
      size: 20,
      index: 1
    };

    $scope.search = function() {
      $rootScope.loadding = true;
      var data = angular.extend($scope.pager, $scope.query);
      $http.get('/backend/api/product/list/', {params: data}).success(function(response) {
        $scope.list = response.data;
        $scope.pager.total = response.total;
        return $rootScope.loadding = false;
      });
    };

    $scope.search();
    $scope.change_page = function() {
      return $scope.search();
    };
    $scope.delete = function(region_id) {
      if (confirm("Confirm delete?")) {
        data = {region_id: region_id};
        $http.post('/backend/api/product/delete/', data).success(function(response) {
          $rootScope.loadding = true;
          $scope.search();
        });
      }
    };

    $scope.save = function(formData) {
      $rootScope.loadding = true;
      var data = formData;
      $http.post('/backend/api/product/create/', data).success(function(response) {
        $rootScope.loadding = false;
        $scope.search();
      });
    };

    $scope.create = function() {
      $scope.formData = {price: 0,
                         stock: 0};
    };

    $scope.update = function(product_id) {
      var data = {product_id: product_id};
      $http.get('/backend/api/product/info/', {params: data}).success(function(response) {
        $scope.formData = response.data;
        $scope.search();
      });
    };

    $scope.delete = function(product_id) {
      var data = {product_id: product_id};
      $http.post('/backend/api/product/delete/', data).success(function(response) {
        $scope.search();
      });
    };

    $scope.uploadFile = function(file_type) {
      $rootScope.loadding = true;
      var file = document.getElementById("imageUpload").files[0];
      return $http({
        url: '/backend/api/upload/file/?file_type=' + file_type,
        method: 'POST',
        data: file
      }).success(function(data, status, headers, config) {
        $rootScope.loadding = false;
        $scope.formData[file_type] = data.data;
        return console.log(data);
      });
    };
  });

  app.controller("orderTotalCtrl", function($scope, $rootScope, $http, $location) {
    $scope.list = [];
    $scope.total_aggregate = [];
    $scope.pager = {
      total: 0,
      size: 20,
      index: 1
    };

    $scope.search = function() {
      $rootScope.loadding = true;
      var data = angular.extend($scope.pager, $scope.query);
      $http.get('/backend/api/order/list/', {params: data}).success(function(response) {
        $scope.list = response.data;
        $scope.pager.total = response.total;
        return $rootScope.loadding = false;
      });
    };

    $scope.change_page = function() {
      return $scope.search();
    };
    $scope.delete = function(region_id) {
      if (confirm("Confirm delete?")) {
        data = {region_id: region_id};
        $http.post('/backend/api/order/delete/', data).success(function(response) {
          $rootScope.loadding = true;
          $scope.search();
        });
      }
    };

    $scope.save = function(formData) {
      $rootScope.loadding = true;
      var data = formData;
      $http.post('/backend/api/product/create/', data).success(function(response) {
        $rootScope.loadding = false;
        $scope.search();
      });
    };

    $scope.create = function() {
      $scope.formData = {price: 0,
                         stock: 0};
    };

    $scope.update = function(product_id) {
      var data = {product_id: product_id};
      $http.get('/backend/api/product/info/', {params: data}).success(function(response) {
        $scope.formData = response.data;
        $scope.search();
      });
    };

    $scope.delete = function(product_id) {
      var data = {product_id: product_id};
      $http.post('/backend/api/product/delete/', data).success(function(response) {
        $scope.search();
      });
    };
  });

  app.controller("orderListCtrl", function($scope, $rootScope, $http, $location) {
    $scope.list = [];
    $scope.total_aggregate = [];
    $scope.pager = {
      total: 0,
      size: 20,
      index: 1
    };
    $http.get('/backend/api/product/mini/list/').success(function(response) {
      $scope.products = response.data;
    });
    $scope.search = function() {
      $rootScope.loadding = true;
      var data = angular.extend($scope.pager, $scope.query);
      $http.get('/backend/api/order/list/', {params: data}).success(function(response) {
        $scope.list = response.data;
        console.log($scope.list);
        $scope.pager.total = response.total;
        return $rootScope.loadding = false;
      });
    };
    $scope.search();
    $scope.change_page = function() {
      return $scope.search();
    };

    $scope.order_info = function(order_id) {
      console.log(order_id);
      var data = {order_id: order_id};
      $http.get('/backend/api/order/info/', {params: data}).success(function(response) {
        $scope.formData = response.data;
      });
    };
  });

  app.controller("orderAbnormalCtrl", function($scope, $rootScope, $http, $location) {
    $scope.list = [];
    $scope.total_aggregate = [];
    $scope.pager = {
      total: 0,
      size: 20,
      index: 1
    };
    $http.get('/backend/api/product/mini/list/').success(function(response) {
      $scope.products = response.data;
    });
    $scope.search = function() {
      $rootScope.loadding = true;
      var data = angular.extend($scope.pager, $scope.query);
      $http.get('/backend/api/product/list/', {params: data}).success(function(response) {
        $scope.list = response.data;
        $scope.pager.total = response.total;
        return $rootScope.loadding = false;
      });
    };

    $scope.change_page = function() {
      return $scope.search();
    };
    $scope.delete = function(region_id) {
      if (confirm("Confirm delete?")) {
        data = {region_id: region_id};
        $http.post('/backend/api/product/delete/', data).success(function(response) {
          $rootScope.loadding = true;
          $scope.search();
        });
      }
    };

    $scope.save = function(formData) {
      $rootScope.loadding = true;
      var data = formData;
      $http.post('/backend/api/product/create/', data).success(function(response) {
        $rootScope.loadding = false;
        $scope.search();
      });
    };

    $scope.create = function() {
      $scope.formData = {price: 0,
                         stock: 0};
    };

    $scope.update = function(product_id) {
      var data = {product_id: product_id};
      $http.get('/backend/api/product/info/', {params: data}).success(function(response) {
        $scope.formData = response.data;
        $scope.search();
      });
    };

    $scope.delete = function(product_id) {
      var data = {product_id: product_id};
      $http.post('/backend/api/product/delete/', data).success(function(response) {
        $scope.search();
      });
    };
  });

}).call(this);
